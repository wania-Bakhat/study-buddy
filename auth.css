// Study Assistant module
const assistant = {
    responses: {
        tips: [
            "Try the Pomodoro Technique: Study for 25 minutes, then take a 5-minute break!",
            "Create a dedicated study space free from distractions.",
            "Break large tasks into smaller, manageable chunks.",
            "Use active recall: Quiz yourself instead of just re-reading notes.",
            "Study at the same time each day to build a routine.",
            "Take regular breaks to avoid burnout - your brain needs rest too!",
            "Use the Feynman Technique: Explain concepts in simple terms.",
            "Get enough sleep - it's crucial for memory consolidation."
        ],
        motivation: [
            "You're doing great! Every small step counts towards your goals!",
            "Remember why you started. Your future self will thank you!",
            "Progress, not perfection. Keep moving forward!",
            "You've overcome challenges before, and you can do it again!",
            "Believe in yourself - you're capable of amazing things!",
            "The struggle you're in today is developing the strength you need tomorrow.",
            "Success is the sum of small efforts repeated day in and day out.",
            "Don't watch the clock; do what it does. Keep going!"
        ],
        break: [
            "Great idea! Take a 5-10 minute break. Stretch, walk around, or grab water.",
            "Stand up and do some light stretching. Your body will thank you!",
            "Step away from your desk. Look at something 20 feet away for 20 seconds (20-20-20 rule).",
            "Take a quick walk outside if possible. Fresh air helps refresh your mind!",
            "Do some deep breathing exercises: Inhale for 4, hold for 4, exhale for 4.",
            "Grab a healthy snack and some water to refuel.",
            "Listen to your favorite song and dance it out!",
            "Call a friend or family member for a quick chat."
        ],
        general: [
            "I'm here to help! Try asking me for study tips, motivation, or break advice.",
            "What would you like to know? I can help with study strategies and motivation!",
            "Feel free to ask me anything about effective studying or staying motivated.",
            "I'm your study companion! Ask me about time management, focus techniques, or just chat!"
        ]
    },

    init: function() {
        this.bindEvents();
        this.loadConversation();
    },

    bindEvents: function() {
        const sendBtn = document.getElementById('send-assistant-message');
        const inputField = document.getElementById('assistant-input-field');
        const quickBtns = document.querySelectorAll('.quick-btn');

        if (sendBtn) {
            sendBtn.addEventListener('click', () => this.handleUserMessage());
        }

        if (inputField) {
            inputField.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    this.handleUserMessage();
                }
            });
        }

        quickBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const action = e.target.getAttribute('data-action');
                this.handleQuickAction(action);
            });
        });
    },

    handleUserMessage: function() {
        const inputField = document.getElementById('assistant-input-field');
        const message = inputField.value.trim();

        if (!message) return;

        this.addUserMessage(message);
        inputField.value = '';

        setTimeout(() => {
            const response = this.generateResponse(message);
            this.addAssistantMessage(response);
        }, 500);
    },

    handleQuickAction: function(action) {
        let response = '';
        
        if (action === 'tips') {
            response = this.responses.tips[Math.floor(Math.random() * this.responses.tips.length)];
        } else if (action === 'motivation') {
            response = this.responses.motivation[Math.floor(Math.random() * this.responses.motivation.length)];
        } else if (action === 'break') {
            response = this.responses.break[Math.floor(Math.random() * this.responses.break.length)];
        }

        this.addAssistantMessage(response);
    },

    generateResponse: function(message) {
        const lowerMessage = message.toLowerCase();

        if (lowerMessage.includes('tip') || lowerMessage.includes('how to study')) {
            return this.responses.tips[Math.floor(Math.random() * this.responses.tips.length)];
        } else if (lowerMessage.includes('motivat') || lowerMessage.includes('encourage')) {
            return this.responses.motivation[Math.floor(Math.random() * this.responses.motivation.length)];
        } else if (lowerMessage.includes('break') || lowerMessage.includes('tired') || lowerMessage.includes('rest')) {
            return this.responses.break[Math.floor(Math.random() * this.responses.break.length)];
        } else if (lowerMessage.includes('procrastinat')) {
            return "Procrastination is normal! Try the 2-minute rule: If a task takes less than 2 minutes, do it now. For bigger tasks, just commit to starting for 2 minutes. Often, starting is the hardest part!";
        } else if (lowerMessage.includes('focus') || lowerMessage.includes('concentrate')) {
            return "To improve focus: Remove distractions, use website blockers if needed, try the Pomodoro Technique, and make sure you're well-rested. Also, silence your phone notifications!";
        } else if (lowerMessage.includes('stressed') || lowerMessage.includes('anxiety')) {
            return "It's okay to feel stressed. Remember to take breaks, practice deep breathing, and don't be too hard on yourself. Consider talking to someone you trust if the stress becomes overwhelming.";
        } else {
            return this.responses.general[Math.floor(Math.random() * this.responses.general.length)];
        }
    },

    addUserMessage: function(message) {
        const chatContainer = document.getElementById('assistant-chat');
        if (!chatContainer) return;

        const messageEl = document.createElement('div');
        messageEl.className = 'user-message';
        messageEl.innerHTML = `<p>${message}</p>`;

        chatContainer.appendChild(messageEl);
        chatContainer.scrollTop = chatContainer.scrollHeight;

        this.saveConversation();
    },

    addAssistantMessage: function(message) {
        const chatContainer = document.getElementById('assistant-chat');
        if (!chatContainer) return;

        const messageEl = document.createElement('div');
        messageEl.className = 'assistant-message';
        messageEl.innerHTML = `
            <i class="fas fa-robot"></i>
            <p>${message}</p>
        `;

        chatContainer.appendChild(messageEl);
        chatContainer.scrollTop = chatContainer.scrollHeight;

        this.saveConversation();
    },

    saveConversation: function() {
        const chatContainer = document.getElementById('assistant-chat');
        if (chatContainer) {
            localStorage.setItem('assistantConversation', chatContainer.innerHTML);
        }
    },

    loadConversation: function() {
        const saved = localStorage.getItem('assistantConversation');
        const chatContainer = document.getElementById('assistant-chat');
        
        if (saved && chatContainer) {
            chatContainer.innerHTML = saved;
        }
    }
};
